\documentclass{article}

% Language setting
% Replace `english' with e.g. `spanish' to change the document language
\usepackage[english]{babel}

% Set page size and margins
% Replace `letterpaper' with `a4paper' for UK/EU standard size
\usepackage[letterpaper,top=2cm,bottom=2cm,left=3cm,right=3cm,marginparwidth=1.75cm]{geometry}

% Useful packages
\usepackage{amsmath}
\usepackage{graphicx}
\usepackage{csquotes}
\usepackage[colorlinks=true, allcolors=blue]{hyperref}
\DeclareMathOperator{\Var}{Var}
\DeclareMathOperator{\E}{E}
\DeclareMathOperator{\Prob}{Prob}
\DeclareMathOperator{\max}{max}
\DeclareMathOperator{\drift}{drift}


\title{Quantitative Models for Options Pricing}
\author{Fabian Farestam, typeset by Om Gupta}
\date{September 2022}

\begin{document}
\maketitle

\section{Introduction}

This document is an overview of quantitative models for option pricing to be implemented in OpenBBTerminal. When learning about options pricing, I recommend you to start with learning the Cox-Ross-Rubinstein Binomial model, then Black-Scholes model and later on advance to more complicated models. \\
Note that none of this is my (Fabian Farestam’s) research. It’s just a reformulation and a collection of material from multiple sources.

\section{Cox-Ross-Rubinstein Binomial Model}

The binomial pricing model has a simple concept, namely that it builds a tree of possible pricing with a certain amount of steps until the time of the options maturity and calculates the arbitrage free price based on this tree. It’s easy to implement (can be $O(2^{n}$)) and also very practical while clearly demonstrating the no arbitrage argument. In special limiting cases of this we can get both the Black-Scholes model as well as the Cox-Ross jump process model (similar to the hybrid jump diffusion model by Merton). \\
The model assumes that:

\begin{itemize}
    \item The stock price follows a multiplicative binominal process over discrete periods
    \item The interest rate is constant and one might borrow and lend as much as wished at this interest rate. (For convenience we assume that r > 1)
\end{itemize}

\subsection{Notation}
\begin{itemize}
    \item $u$: Asset return with the probability of q 
    \item $d$: Asset return with the probability of 1 - q
    \item $S$: Stock Price
    \item $q$: Probability of tree path taken
    \item $r$: Riskless interest rate
    \item $C$: Value of a call option
    \item $K$: Strike Price
\end{itemize}

\subsection{One Step Tree}
The setup is simple, the stock returns over each period is either $u - 1$ with the probability of $q$, or $d - 1$ with the probability $1 - q$. Thus the price at the end of the period will be $uS$ or $dS$. Note that the relation $u > r > d$ must always be held. An illustration of this is:

\begin{figure}
\centering
\includegraphics[width=0.3\textwidth]{one-step-tree.png}
\caption{\label{fig:onestep}Source: Cox, Ross, Rubinstein}
\end{figure}

To calculate the value of this simple setup, where there’s only one step, we use:
\begin{align*}
    C_{u} = \max(0, uS - K) \\
    C_{d} = \max(0, dS - K)
\end{align*}
When using a number of shares, $g$ (some use $\delta$ instead of g) and dollar invested in riskless bonds, $B$. Thus:
\begin{align*}
    C_{u} = g u S + r B \\
    C_{d} = g d S + r B 
\end{align*}
After solving for $g$ and $B$,
\begin{align}\label{eq:1}
    \begin{split}
    g = \frac{C_{u} - C_{d}}{(u - d)S} \\
    B = \frac{uC_{d} - dC_{u}}{(u - d)r}
    \end{split}
\end{align}
If no arbitrage exists then:
\begin{equation*}
    C = gS +B
\end{equation*}
Which then implies
\begin{equation}\label{eq:2}
    C = \frac{p C_{u} + (1 - p) C_{d}}{r}
\end{equation}
where $p=\frac{r-d}{u-d}$ and $1-p=\frac{u-r}{u-d}$ \\ [5ex]
From \ref{eq:2} we can make three observations:
\begin{enumerate}
    \item $q$ is not used, thus even if investors have different opinions about the probabilities they can still agree to this relationship! ($p$ is $q$ if investors were to be risk neutral)
    \item Investor’s risk attitude doesn’t matter.
    \item The stock price is the only random variable.
\end{enumerate}
\subsection{Two Step Tree}
For a two step tree we get the following structure:\\
\begin{figure}
\centering
\includegraphics[width=0.3\textwidth]{two_step_tree.png}
\caption{\label{fig:twostep}Source: Cox, Ross, Rubinstein}
\end{figure}
To this new tree we adapt \ref{eq:2}
\begin{align}\label{eq:3}
    \begin{split}
    C_{u} = \frac{p C_{uu} + (1-p) C_{ud}}{r} \\
    C_{d} = \frac{p C_{du} + (1-p) C_{dd}}{r}
    \end{split}
\end{align}
We don't need to change \ref{eq:1}  but just we need to adjust our hedge portfolio with the new values gotten from \ref{eq:3} \\
So to get the value of the call we substitute \ref{eq:3} into \ref{eq:2}, which results in:
\begin{align}\label{eq:4}
    \begin{split}
    C & = \frac{p^{2} C_{uu} + 2 p (1 - p)  C_{ud} + (1 - p)^{2}  C_{dd}}{r} \\
    & = \frac{p^{2}*\max(0, u^{2}S - K) + 2 p (1 - p) * \max(0, duS - K)}{r}
    \end{split}
\end{align}
From this we conclude that all assumptions made from \ref{eq:2} also hold for \ref{eq:4}. Now the list of variables that determine $C$ is $S, K, n, u, d$ and $r$.
\subsection{Binomial tree with any amount of steps}
We can find the call value recursively, by starting at the expiration and working backwards, for any amount of steps:
\begin{equation}\label{eq:5}
    C = \frac{\sum_{j=0}^{n} {n \choose j} p^{j}(1-p)^{n-j}\max(0, u^{j}d^{n-j}S - K)}{r^{n}}
\end{equation}
We’re not yet done since we can express this in a way nicer form by some transformations:
\begin{equation}\label{eq:6}
    C = \frac{\sum_{j=a}^{n} {n \choose j} p^{j}(1-p)^{n-j} (u^{j}d^{n-j}S - K)}{r^{n}}
\end{equation}
where $a$ (represents minimum stock upwards moves for finishing in the money) is the smallest non negative larger greater than $\frac{\log(K / S d^{n})}{\log(u / d)} $ \\
We'll break up the above formula into two terms:
\begin{equation}\label{eq:7}
    C = S *\frac{\sum_{j=a}^{n} {n \choose j} p^{j}(1-p)^{n-j} (u^{j}d^{n-j})}{r^{n}} - K * \frac{\sum_{j=a}^{n} {n \choose j} p^{j}(1-p)^{n-j}}{r^{n}}
\end{equation}
In formula \ref{eq:7} we have two brackets, when taking a closer look at them one realises that we can express them as complementary binomial distribution function $\phi$. We can sum this up as the final simple Binomial Pricing formula:
\begin{equation}\label{eq:8}
    C = S *\phi(a; n, p) - K r^{-n} * \phi(a; n, p')
\end{equation}
where $p=\frac{r-d}{u-d}$ and $p'=\frac{u}{r}p$\\ [2ex]
Note that the formula above is only valid for American non-dividend paying call options.
\subsection{Dividends}
In this part in order to account for the dividend we assume that the stock has a constant dividend yield, $\delta$ on the ex-dividend date and a total of $v$ ex-dividend days. To account for dividend we need to define $\rho$ as one plus the interest rate over a period of $h=\frac{t}{n}$. The total return  is $\rho^{n} = r^{t}$, and we can express $\rho= r^{\frac{t}{n}}$. \\
A major difference in this model “extension“ is that early exercise is optimal in some cases. Early exercise is in fact optimal when $S > S^{*}$, where $S^{*}$ is the “critical” price of the stock where the following equation holds:
\begin{equation}\label{eq:9}
    S^{*} - K = \frac{p*C(n,i-1,j+1) + (1-p)*C(n,i-1,j)}{\rho}
\end{equation}
for $j = 0, 1, 2, .., n-i$ where $C(n, i, j) =$ call value $n-i$ periods from now, $S^{*} = u^{j}d^{n-i-j}(1-\delta)^{v(n,1)}*S$, and $v(n,i)=\sum_{k=1}^{n-1}v_{k}$ \\ [4ex]
From \ref{eq:9}, we get 
\begin{equation}\label{eq:10}
   C(n,i,j) = \max\left(u^{j}d^{n-i-j}(1-\delta)^{v(n,1)}*S - K, \frac{p*C(n,i-1,j+1) + (1-p)*C(n,i-1,j)}{\rho}\right)
\end{equation}
Important to note is that here we traverse the price the binomial tree recursively, thus starting with $i = 0$ and ending with $i = n$. We apply the previous results into the calculations of the previous ones. \\ [2ex]
The hedge ratio of the portfolio is:
\begin{equation*}
    g = \frac{C(n, n - 1, 1) - C(n, n -1, 0)}{(u - d) * S}
\end{equation*}
\subsection{Limiting Cases: Black-Scholes + Cox-Ross jump process}
We’ll start exploring these limiting cases by splitting our steps into small pieces. By setting $h$, the time elapsed between each step, as $h = \frac{t}{n}$. Now to get to a continuous tree we simply set $n -> \infty$. Again, we have $\rho^{n} = r^{t}$ so that $\rho = r^{\frac{t}{n}}$\\ [2ex]
From here we need to express $u$ and $d$ in terms of $n$. There’s two ways, one results in the Black Scholes model and the other in the Cox-Ross jump process model.
\subsubsection{Black-Scholes}
We’ll express the returns $u$ and $d$ from here on as $\log u$ and $\log u$, so over multiple periods we get that the final stock return is:
\begin{equation}\label{eq:11}
    \log (\frac{S^{*}}{S}) =  j \log u + (n - j) * \log d = j \log \left(\frac{u}{d}\right) + n \log d
\end{equation}
$j$ is the random number of upwards moves, which occurred during $n$ periods. We can now express the expected return and the return variance:
\begin{align*}
    \E[\log (\frac{S^{*}}{S})] &= \log \left(\frac{u}{d}\right)*\E[j] + n \log d \\
    \Var[\log (\frac{S^{*}}{S})]& = (\log \left(\frac{u}{d}\right))^{2}*\Var[j]
\end{align*}
Since $\E[j] = n q$; and $\Var[j] = n q (1 - q)$; (due to the variance of one period being: $q(1-q)^{2} + (1-q)(0 - q)^{2} = q(1-q))$. Now we simplify the formulas above:
\begin{gather}
\begin{split}
    \E[\log (\frac{S^{*}}{S})] = (\log \left(\frac{u}{d}\right)q +\log d)*n  = \mu n \\
    \Var[\log (\frac{S^{*}}{S})] = (\log \left(\frac{u}{d}\right))^{2}q(1-q)*n = \sigma n
\end{split}
\end{gather}
Now we need to adjust $u$ and $d$ so that we get realistic results. Below $\overline{\mu}$ and $\overline{\sigma}$ are the empirical values of $\mu$ and $\sigma$ to so we get the empirical values after adjusting $u$ and $d$. \\ [3ex]
As $n -> \infty$ :
\begin{gather*}
    (\log \left(\frac{u}{d}\right)q +\log d)*n -> \overline{\mu}n \\
    (\log \left(\frac{u}{d}\right))^{2}q(1-q)*n -> \overline{\sigma} n
\end{gather*}
Thus, 
\begin{gather}
\begin{split}
    u = \exp\left(\overline{\sigma}h^{\frac{1}{2}}\right) \\
    d = \exp\left(-\overline{\sigma}h^{\frac{1}{2}}\right) \\
    q = \frac{1+\frac{\overline{\sigma}}{\overline{\mu}}\left(\frac{n}{t}\right)^{\frac{1}{2}}}{2}
\end{split}
\end{gather}
This makes that every probability and possible outcome get changed. Now we use the central limit theorem, when applied it to our problem, says that as $n -> \infty$, if \ref{eq:14} below holds then \ref{eq:15} applies, where $N(z)$ is the standard normal distribution:
\begin{align} \label{eq:14}
    \frac{q|\log u - \mu|^{3} + (1-q)|\log d - \mu|^{3}}{\sigma^{3}n^{\frac{1}{2}}} & -> 0 \\
    \Prob\left[\frac{\log\left(\frac{S^{*}}{S}\right) - \mu n}{\sigma n^{\frac{1}{2}}}\right] & -> N(z) \label{eq:15}
\end{align}
When we rewrite the Black Scholes theorem in terms of the the previously used notation, we get:
\begin{equation}
   C =  S N(x) - K r^{-t} N(x - \sigma t^{\frac{1}{2}})
\end{equation}
where $x = \frac{\log\left(\frac{S}{Kr^{-t}}\right)}{\sigma t^{\frac{1}{2}}} + \frac{\sigma t^{\frac{1}{2}}}{2}$
\subsubsection{Cox Ross Jump Process}
To get the Cox-Ross jump process model, we set $u$, $d$, and $q$ to the following values:
\begin{gather*}
    u = u \\
    d = \exp\left(\zeta \left(\frac{t}{n}\right)\right) \\
    q = \lambda \left(\frac{t}{n}\right) \\
\end{gather*}
where $\lambda$ is the intensity function (or rate) of the underlying Poisson process and $\zeta$ is related to the intensity measure of the distribution.\\
The central limit theorem no longer holds for these values and the stock price converges to a log-Poisson distribution as $n -> \infty$. This complementary Poisson distribution can be expressed in the following form:
\begin{equation}
    \psi (x,y) = \sum_{i=x}^{\infty} \frac{e^{-y}y^{i}}{i!}
\end{equation}
This allows the Cox-Ross jump process model to be written as:
\begin{equation}
    C = S \psi(x,y) - Kr^{-t} \psi\left(x,\frac{y}{u}\right)
\end{equation}
where $y=\frac{(\log r - \xi) u t }{u-1}$ and $x$ is the the smallest non-negative integer greater than $\frac{\log\left(\frac{K}{S}\right)}{\log u}$
\section{Black-Scholes Model}
\subsection{Notation}
\begin{itemize}
    \item $S_{t}$: Price of underlying asset at time $t$
    \item $\mu$: Annualized drift rate of $S$
    \item $\sigma$: Standard deviation of the asset's log returns
    \item $\phi (m,s)$: Normal distribution with mean $m$ and standard deviation of $s$
    \item $\eta$: Continuously compounded rate of return
    \item $U$: Annualized annual expected return in period $\Delta t$
    \item $V$: Annualized annual expected return expressed in a compounding frequency of $\Delta t$ over a longer period of time
    \item $\epsilon$: random from the standard normal distribution $\phi(0, 1)$
    \item $r$: Annual risk-free rate of interest
    \item $f$: Price of derivative
\end{itemize}
\subsection{Assumptions}
These assumptions are used to derive the Black-Scholes-Merton differential equation and the equation only holds in this theoretical environment. Note that some of these assumptions can and will be accounted for at a later stage of the document. For instance interest rates can be stochastic, thus relaxing the conditions assumed.
\begin{itemize}
    \item Random walk - Asset prices follow geometric Brownian motion: 
    \begin{equation*}
        dS = \mu S dt + \sigma S dz
    \end{equation*}
    \item Lognormal distributions - this results in that the price at time T corresponds to: 
    \begin{equation} \label{eq:19}
        \ln S_{T} \sim \phi\left(\ln S_{0} + \left(\mu - \frac{\sigma^{2}}{2}\right)T, \sigma T^{\frac{1}{2}}\right)
    \end{equation}
    \item Non dividend (will later show dividend extension)
    \item Market:
    \begin{itemize}
        \item No arbitrage
        \item Lend and borrow
        \item Buy and short
        \item No transaction fees
        \item Continuous security trading
    \end{itemize}
    \item $\mu$, $r$, and $\sigma$ are constant
    \item $r$ is the same for all maturities
\end{itemize}
\subsection{Calculations}
If we start with the normal distribution of returns we get that the expected value of $S_{T}$, $\E[S_{T}]$: 
\begin{equation*}
    \E[S_{T}] = S_{0} e^{\mu T}
\end{equation*}
and variance of $S_{T}$:
\begin{equation*}
    \Var[S_{T}] = S_{0}^{2} e^{2\mu T}[e^{\sigma^{2}T}-1]
\end{equation*}
\subsubsection{Rate of Return}
Further using the log normal properties of the price at time $T$ we get: 
\begin{equation*}
    S_{T} = S_{0} e^{\eta T}
\end{equation*}
and it follows that 
\begin{equation} \label{eq:20}
    \eta = \frac{1}{T} \ln\left(\frac{S_{T}}{S_{0}}\right)
\end{equation}
For correctly understanding \ref{eq:20} we need to get $\ln\left(\frac{S_{T}}{S_{0}}\right))$, we get this when transforming \ref{eq:19}: 
\begin{equation}
    \ln\left(\frac{S_{T}}{S_{0}}\right) \sim \phi\left(\left(\mu - \frac{\sigma^{2}}{2}\right)T, \sigma T^{\frac{1}{2}}\right)
\end{equation}
So it then follows that 
\begin{equation} \label{eq:22}
    \eta = \left(\mu - \frac{\sigma^{2}}{2}, \frac{\sigma} {T^{\frac{1}{2}}}\right)
\end{equation}
Now we can define $V$ (expected return over a longer period of time) from \ref{eq:22}, which results in:
\begin{equation} \label{eq:23}
    V = \mu - \frac{\sigma^{2}}{2}
\end{equation}
In order to compare it to $U$ and properly understand it, we express geometric Brownian motion in discrete-time:
\begin{equation} \label{eq:24}
    \frac{\Delta S}{S} = \mu \Delta t + \sigma \epsilon (\Delta t)^{\frac{1}{2}}
\end{equation}
$U$ is then naturally:
\begin{equation} \label{eq:25}
    U = \mu \Delta t
\end{equation}
\subsubsection{Volatility}
Further drawing from \ref{eq:24} we get that as $\Delta t$ approaches zero, we can see that $\sigma (\Delta t)^{\frac{1}{2}}$ is approximately equal to the standard deviation of proportional change in asset price in $\Delta t$ \\ [2ex]
In equation \ref{eq:20} “the volatility of a stock price can be defined as the standard deviation of the return provided by the stock in one year when the return is expressed using continuous compounding“ (citation from John C. Hull see sources).\\ [2ex]
While in \ref{eq:19} we see that vol (volatility) is also the stdev (standard deviation) of the natural logarithmic asset price  at the end of one year.
\subsubsection{Ito's Lemma}
The price of any derivate is a function of stochastic variables of the derivative underlying and time, thus we need to understand some of the behaviour of functions of stochastic variables, known as Ito’s lemma. The value of a variable x follows an Ito process:
\begin{equation} \label{eq:26}
    dx = a(x, t) dt + b(x, t) dz
\end{equation}
Here $a$ and $b$ are functions of $x$ and $t$ and $dz$ is a Wiener process. The drift rate of $x$ is thus $a$ and the variance of $x$ is $b^{2}$. \\ [2ex]
What Ito’s lemma says is essentially that a function, G, of x and t, where dz is the same Wiener process as above in \ref{eq:26}, follows an Ito process:
\begin{equation} \label{eq:27}
    dG = \left[\frac{\partial G }{\partial x} a + \frac{\partial G }{\partial t} + \frac{1}{2}\frac{\partial^{2} G }{\partial x^{2}} * b^{2}\right]dt + \frac{\partial G }{\partial x} b dz
\end{equation}
Thus, the drift rate is 
\begin{equation} \label{eq:28}
    \drift(G) = \frac{\partial G }{\partial x} a + \frac{\partial G }{\partial t} + \frac{1}{2}\frac{\partial^{2} G }{\partial x^{2}} * b^{2}
\end{equation}
and the variance
\begin{equation} \label{eq:29}
    \Var[G] = (\frac{\partial G }{\partial x} b)^{2}
\end{equation}
Now from Ito’s lemma we can set $a = \mu S$ , $b = \sigma S$ and $x = S$ into \ref{eq:27}:
\begin{equation} \label{eq:30}
    dG = \left[\frac{\partial G }{\partial S} \mu S + \frac{\partial G }{\partial t} + \frac{1}{2}\frac{\partial^{2} G }{\partial S^{2}} * \sigma^{2} S^{2}\right]dt + \frac{\partial G }{\partial S} \sigma S dz
\end{equation}
(Note that the source of uncertainty dz affects both S and G)
\subsubsection{Derivation of the Black-Scholes-Merton differential equation}
Since $f$ is the price of the derivate on S, $f$must be a function of $S$ and $t$. Now we’ll use formula \ref{eq:30} with respect to $f$ rather than $G$:
\begin{equation} \label{eq:31}
    df = \left[\frac{\partial f }{\partial S} \mu S + \frac{\partial f }{\partial t} + \frac{1}{2}\frac{\partial^{2} f }{\partial S^{2}} * \sigma^{2} S^{2}\right]dt + \frac{\partial f }{\partial S} \sigma S dz
\end{equation}
or in discrete form (note \ref{eq:24})
\begin{equation} \label{eq:32}
    \Delta f = \left[\frac{\partial f }{\partial S} \mu S + \frac{\partial f }{\partial t} + \frac{1}{2}\frac{\partial^{2} f }{\partial S^{2}} * \sigma^{2} S^{2}\right]\Delta t + \frac{\partial f }{\partial S} \sigma S \Delta z
\end{equation}
In the discrete form of the Brownian process, 
\begin{equation}\label{eq:33}
        \Delta S = \mu S \Delta t + \sigma S \Delta z
    \end{equation}
As mentioned in the section about Ito’s lemma, \ref{eq:26} and \ref{eq:27} have the same Wiener process, thus we get that $f$ and $S$ follow the same Wiener process! We can therefore say $\Delta z = \sigma \epsilon (\Delta t)^{\frac{1}{2}}$ see \ref{eq:24} in the formulas \ref{eq:32} and \ref{eq:33} are the same! \\ [2ex]
Hull describes it the best here:
\begin{displayquote}
It follows that by choosing a portfolio of stock and the derivate, the Wiener process can be eliminated. The appropriate portfolio is: \\
-1: derivate\\
$\frac{\partial f }{\partial S} $ : Shares\\ [2ex]
The holder of this portfolio is short one derivate and long an amount of $\frac{\partial f }{\partial S}$ of shares.
\end{displayquote}
So we define $\Pi$ as the portfolio value, thus:
\begin{equation}\label{eq;34}
\begin{split}
    \Pi = -f + \frac{\partial f }{\partial S} S \\
    \Delta \Pi = -\Delta f + \frac{\partial f }{\partial S} \Delta S
\end{split}
\end{equation}
Since we assume that there is no arbitrage $\Delta z$ must be 0, since the portfolio must be riskless during $\Delta t$ and earn the risk-free rate (otherwise there would be arbitrage). It follows that:
\begin{equation}\label{eq:35}
    \Delta \Pi = r \Pi \Delta t
\end{equation}
When we plug \ref{eq:32} and \ref{eq:33} in \ref{eq;34}, we get
\begin{equation}\label{eq:36}
    \Delta \Pi = - \left[\frac{\partial f }{\partial t} - \frac{1}{2}\frac{\partial^{2} f }{\partial S^{2}} * \sigma^{2} S^{2}\right] \Delta t
\end{equation}
Using \ref{eq:35} and \ref{eq:36}, we get 
\begin{equation}
    \frac{\partial f }{\partial t} + r S \frac{\partial f}{\partial S} +\frac{1}{2}\frac{\partial^{2} f }{\partial S^{2}} * \sigma^{2} S^{2} - rf = 0
\end{equation}\\
Finally we have arrived to the Black-Scholes-Merton differential equation!\\[3ex]
The BSM differential equation is riskless for a infinitesimally small time period ($lim_{\Delta t\to\ 0}$). Since $S$ and $t$ changes, $\frac{\partial f}{\partial S}$ changes as well, so the ratio between stocks and derivates kept in the portfolio gets rebalanced. \\[2ex]
The particular derivate depends on the boundary conditions that are used. Different boundary condition results in different derivates. For instance for European call options you need to use the following boundary conditions at $t=T$:
\begin{equation*}
    f = \max (S - K, 0)
\end{equation*}
or for an European put option, it is:
\begin{equation*}
    f = \max (K - S, 0)
\end{equation*}
\subsection{Pricing Formulas}
\subsubsection{European options}
We get the formulas for European options by solving the BSM differential equation for the previously mentioned boundaries (where $c$ for call and $p$ for put is used):
\begin{align}
    \begin{split} \label{eq:38}
        c &= S_{0}N(d1) - X e-^{rT} N(d2) \\ 
        p &= X e^{-rT} N(-d2) - S_{0} N(-d1)
    \end{split}
\end{align}
where 
\begin{gather*}
        d_{1} = \frac{\ln\left(\frac{S_{0}}{K}\right)+\left(r^{2}+\frac{\sigma^{2}}{2}\right)T}{\sigma T^{\frac{1}{2}}} \\
        d_{2} = \frac{\ln\left(\frac{S_{0}}{K}\right)+\left(r^{2}-\frac{\sigma^{2}}{2}\right)T}{\sigma T^{\frac{1}{2}}} = d_{1} - \sigma T^{\frac{1}{2}}
\end{gather*}
The input for dividend paying European options has to be adjusted, which is covered in the Appendix
\subsubsection{American call options with non-dividend paying stocks}
American call option on a stock that pays no dividends during the life of the option will not be exercised early and, hence, can be valued as a European option with the standard Black-Scholes formula.
\subsubsection{European warrants issued by firm on its own stocks}
\begin{equation}
    W = \left[\left(S_{0} + \frac{M}{N}W\right)N(d_{1}) - Ke^{-rT}N(d_{2})\right]\frac{N\gamma}{N + M\gamma}
\end{equation}
where 
\begin{itemize}
    \item $\gamma$ : The amount of shares per warrant
    \item $N$ : Outstanding shares
    \item $M$ : Outstanding European warrants
\end{itemize}
\subsection{Modelling Input}
\subsubsection{Estimating volatility}
If we define
\begin{itemize}
    \item $n+1$ : Observations
    \item $\tau$ : Time in years
    \item $u_{i}$ : Continuously compounded return in i\emph{th} interval
\end{itemize}
Due to $S_{i}= S_{i-1} e^{ui}$,
\begin{equation}
    u_{i} = \ln \left(\frac{S_{i}}{S_{i-1}}\right)
\end{equation}
To then calculate the deviations from the mean we use a similair calculation as with the standard deviation:
\begin{equation*}
    s = \left(\frac{1}{n-1} \sum_{i=1}^{n}u_{i}^{2} - \frac{1}{n(n-1)}\left(\sum_{i=1}^{n}u_{i}\right)^{2}\right)^\frac{1}{2}
\end{equation*}
Now, we see from \ref{eq:19} that $\sigma ^{*} = \frac{s}{\tau^{\frac{1}{2}}}$ but this has some flaws so the standard error can be shown to be
\begin{equation}
    \alpha = \frac{\sigma ^ {*}}{(2n)^{0.5}}
\end{equation}
Choosing n is hard, so here is the general recommendation from Hull:
\begin{displayquote}
Choosing an appropriate value for n is not easy. Ceteris paribus, more data generally leads to more accuracy. However, σ does change over time and data that are too old may not be relevant for predicting the future. A compromise that seems to work reasonably well is to use closing prices from daily data over the most recent 90 to 180 days. An often used rule of thumb is to set the time period over which the volatility is measured equal to time period over which it is applied.
\end{displayquote}
GARCH can also be used, see the GARCH Models in volatility models. \\
If the stock pays dividend, we just need to change ui during a time interval that includes an ex-dividend day, given by:
\begin{equation}
    u_{i} = \ln \left(\frac{S_{i}+D}{S_{i-1}}\right)
\end{equation}
where $D$ is the dividend amount
\section{Merton's Jump-Diffusion Model}
The Jump-Diffusion model assumes that underlaying asset follows a jump-diffusion process. The downside from this is that it requires two more input parameters, which are “hard” to observe in the market. The parameters are the following:
\begin{itemize}
    \item $\lambda$ : Expected number of jumps per year
    \item $\gamma$ : Percentage of total volatility explained by the jumps
\end{itemize}
The JmpDif (Jump-Diffusion model) solves the problem with the “Mes Mile-effect“ that comes with the BSM model. It also doesn’t assume the log normal distribution. Prices of assets vary in “normal“ vibrations in price, for example due to temporary supply and demand imbalances, and in “abnormal“ vibrations, caused by asset/sector specific news (for example quarterly reports). The “normal“ vibrations can be modelled by geometric Brownian motion and the “abnormal“ by a “jump“ process.
\subsection{Additional Notation}
\begin{itemize}
    \item $a$: Instantaneous expected asset return
    \item $\epsilon$: Expectations operator
    \item $k$: Percent change of asset price if event occurs
    \item $W$: Options price
    \item $P$: Portfolio value
    \item $\tau$: Time to expiry
    \item $E$: Exercise price
\end{itemize}
\subsection{Calculations}
\subsubsection{Poisson-driven Process}
To start to describe the above mentioned “jump“ process, we’ll use a “Poisson-driven“ process. We now look at the probability of an event occurring in this Poisson distributed process:
\begin{enumerate}
    \item $\Prob$[event doesn't occurs in time interval $(t, t+h)$] = $1- \lambda h + O(h)$
    \item $\Prob$[event occurs once in time interval $(t, t+h)$] = $\lambda h + O(h)$
    \item $\Prob$[event occurs multiple times in time interval $(t, t+h)$] = $O(h)$
\end{enumerate}
Above, we can set $h$ to whatever we want. $O(h)$ is the asymptotic order symbol defined by $\psi(h) = O(h)$ when $\lim_{h\to 0} \left[\frac{\psi(h)}{O(h)}\right] = 0.$ $\lambda$ is the mean number of arrivals per time unit. \\ [2ex]
If this event occurs, then we draw Y from a distribution, so if we ignore the continuity we would get something like $S(t+h) = S(t) Y$ \\ 
The stock price can be expressed stochastically as:
\begin{equation}\label{eq:43}
    \frac{dS}{S} = (a - \lambda k) dt + \sigma dz + dq
\end{equation}
In the formula above $\sigma^{2}$ is the variance at the moment (if no Poisson event occurs), dz is the standard Gauss-Wiener process and $q(t)$ is the Poisson process of the event described above. k is defined as $\epsilon(Y - 1)$, where $(Y- I)$ is the random variable percentage change in the stock price if the Poisson event occurs. \\ [2ex]
To make it clear, \ref{eq:43} can be rewritten as:
\begin{equation*}
    \frac{dS}{S} = (a - \lambda k) dt + \sigma dz
\end{equation*}
if event doesn't occur and
\begin{equation*}
    \frac{dS}{S} = (a - \lambda k) dt + \sigma dz + (Y-1)
\end{equation*}
if event does occur\\
Setting a, $\lambda$, k and $\sigma$ to constants, then the random ratio of stock price at time 0 and time $t$ is:
\begin{equation}
    \frac{S_{t}}{S_{0}} = \exp \left(a - \frac{\sigma^{2}}{2} - \lambda k t + \sigma z(t)\right) Y(n)
\end{equation}
$z(t)$ is a Gaussian random variable, which has a mean of 0 and variance of $t$. $Y(n)$ is defined as:
\begin{equation}
    Y(n) = \begin{cases} 1 \text{ , if } n=0 \\
    \Pi_{j=1}^{n} Y_{j} \text{ , if } n\geq1
    \end{cases}
\end{equation}
$Y_{j}$ are independently and identically distributed and $n$ is Poisson distributed with parameter $\lambda t$.
Now, we apply \ref{eq:43} to the options price, $W$, where $W(t) = F(S, t)$
\begin{equation}
    \frac{dW}{W} = (a_{W} - \lambda  k_{W}) dt + \sigma_{W} dz + dq_{W}
\end{equation}
It has the same terminology as \ref{eq:43} but everything is for the option \\ [2ex]
When applying Ito’s lemma to the continuous part and a similar to the Poisson process we get:
\end{document}